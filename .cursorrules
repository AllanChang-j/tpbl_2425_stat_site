# Project: TPBL Advanced Stats & RAPM Platform

You are a Senior Full Stack Engineer and Data Product Designer. Your task is to build a public basketball data query platform for the TPBL (Taiwan Professional Basketball League).

## 0. Design & UI/UX Patterns (Derived from NBA.com & TPBL Official)
Based on the analysis of NBA Stats and TPBL reference files, you must implement the following design system:

- **Visual Style (TPBL Identity):**
  - **Primary Colors:** Slate-900 (Black/Dark Grey) for headers/primary actions, Gold (#C9A050) for accents/highlights.
  - **Background:** #F9FAFB (Gray-50) for the page background, #FFFFFF for content cards/tables.
  - **Typography:** `Inter` or `Roboto` for English/Numbers (tabular-nums for data), `Noto Sans TC` for Chinese. Bold weights for headers, Regular for data.
  - **Interaction:** Hover rows in tables must highlight with `bg-gray-50`. Active filters should use the primary color.

- **Layout Structure (NBA Stats Density):**
  - **Sticky Header:** Main navigation and sub-navigation (Players, Leaders, Lineups) must stick.
  - **Filter Bar:** Positioned directly above the data table.
  - **Table:** High density (Compact). 
    - **Frozen Columns:** "Rank" and "Player Name" must be frozen (sticky left) on mobile/horizontal scroll.
    - **Sortable Headers:** Click to sort, with clear arrow indicators.

## 1. Tech Stack (Hard Requirements)
- **Framework:** Next.js 14+ (App Router)
- **Language:** TypeScript
- **Styling:** Tailwind CSS + shadcn/ui (Components)
- **Data Parsing:** PapaParse (Client-side CSV parsing)
- **Validation:** Zod (Schema validation for CSV rows & filter rules)
- **Charts:** Recharts (for Radar/Bar charts in Compare mode)
- **Icons:** Lucide React

## 2. Core Data Logic (CRITICAL)
**DO NOT pre-calculate unit conversions offline.**
The CSV files in `/public/data/` contain suffixes like `_per_game`, `_per36`, `_per100`.
You must implement a **"Display Unit"** logic in the frontend:
1. User selects a unit: `Raw`, `Per Game`, `Per 36`, `Per 100`.
2. The UI Component dynamically determines which object key to render.
   - Example: If user selects "Per 36" and wants to show "Points":
   - Check if `PTS_per36` exists. If yes, display it.
   - If no, fallback to `PTS` (raw).

## 3. Functional Requirements

### A. Global Filter System
- **Unit Toggle:** Raw / Per Game / Per 36 / Per 100 Poss.
- **Team Selector:** Multi-select (1-7 teams).
- **Custom Conditions:** Allow up to 5 AND conditions (Field + Operator + Value). Only numeric fields allowed.
- **Min Thresholds:** Sliders for Min Possessions, Min Minutes, Min Games.
- **Interaction:** Changes must trigger a re-filter of the data (client-side).

### B. Data Tables (Players & Lineups)
- **Pagination:** Client-side pagination.
- **Sorting:** Multi-column sort support.
- **Search:** Fuzzy search by Player Name / Lineup Player Names.
- **Columns:** Use the "Field Mappings" defined below.

### C. Compare Mode
- **Selection:** Allow selecting up to 5 Players or Lineups.
- **Visuals:** Side-by-side cards + Radar Chart.
- **Diff Mode (A - B):** - User selects Base (A) and Target (B).
  - Calculate `Delta = A - B`.
  - Display Delta with color coding (Green for positive "good" stats, Red for negative).

### D. Data Dictionary
- Implement a Drawer/Modal triggered by an Info icon in table headers.
- Show: Label (ZH/EN), Definition, Formula.

## 4. Field Mappings (Strict Enforcement)
Use these EXACT mappings for Table Headers, Filters, and Dictionary. Create a constant file `lib/constants.ts` for these.

See `lib/constants.ts` for the complete field mappings.

## 5. Implementation Notes
- All data is loaded client-side from CSV files in `/public/data/`
- Use Zod schemas for data validation
- Implement proper TypeScript types for all data structures
- Ensure responsive design for mobile devices
- Optimize for performance with proper memoization

